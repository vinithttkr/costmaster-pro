<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CostMaster Pro - Training Simulator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 36px;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .download-section {
            background: #fff3cd;
            border: 3px solid #ffc107;
            padding: 20px;
            margin: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .btn-download {
            background: #28a745;
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 18px;
            font-weight: bold;
            border-radius: 8px;
            cursor: pointer;
            margin: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: all 0.3s;
        }

        .btn-download:hover {
            background: #218838;
            transform: translateY(-2px);
        }

        .tabs {
            display: flex;
            background: #f0f0f0;
            border-bottom: 3px solid #2a5298;
            overflow-x: auto;
        }

        .tab {
            padding: 15px 25px;
            cursor: pointer;
            background: #e0e0e0;
            border: none;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s;
        }

        .tab.active {
            background: white;
            color: #2a5298;
        }

        .sheet {
            display: none;
            padding: 30px;
        }

        .sheet.active {
            display: block;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        th {
            background: #2a5298;
            color: white;
            padding: 14px;
            text-align: left;
            font-weight: bold;
            border: 1px solid #1e3c72;
        }

        td {
            padding: 12px;
            border: 1px solid #ddd;
        }

        tr:nth-child(even) {
            background: #f9f9f9;
        }

        input[type="number"] {
            width: 100%;
            padding: 8px;
            border: 2px solid #ddd;
            border-radius: 4px;
        }

        .total-row {
            background: #2a5298 !important;
            color: white !important;
            font-weight: bold;
        }

        .favorable {
            background: #d4edda !important;
            color: #155724;
            font-weight: bold;
            text-align: center;
        }

        .unfavorable {
            background: #f8d7da !important;
            color: #721c24;
            font-weight: bold;
            text-align: center;
        }

        .variance-positive {
            color: #dc3545;
            font-weight: bold;
        }

        .variance-negative {
            color: #28a745;
            font-weight: bold;
        }

        .button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 16px;
            font-weight: bold;
            border-radius: 8px;
            cursor: pointer;
            margin: 10px 5px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 12px;
        }

        .card .value {
            font-size: 42px;
            font-weight: bold;
            margin: 15px 0;
        }

        .score-card {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            text-align: center;
            padding: 50px;
            margin: 20px 0;
            border-radius: 15px;
            color: white;
        }

        .score-card .score {
            font-size: 90px;
            font-weight: bold;
            margin: 20px 0;
        }

        .scoring-breakdown {
            background: #f9f9f9;
            border-left: 5px solid #2a5298;
            padding: 20px;
            margin: 15px 0;
            border-radius: 5px;
        }

        .points {
            font-size: 28px;
            font-weight: bold;
            color: #2a5298;
            float: right;
        }

        .instructions {
            background: #e7f3ff;
            border: 2px solid #2196F3;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéØ CostMaster Pro - Training Simulator</h1>
            <p>Complete Gamified Cost Control Training System</p>
        </div>

        <div class="download-section">
            <h2>üì• Export Your Data</h2>
            <button class="btn-download" onclick="exportToCSV()">üìä Download as CSV (Excel Compatible)</button>
            <button class="btn-download" onclick="downloadThisPage()" style="background: #007bff;">üíæ Save This Page</button>
            <button class="btn-download" onclick="window.print()" style="background: #6c757d;">üñ®Ô∏è Print</button>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showSheet('dashboard')">üìä Dashboard</button>
            <button class="tab" onclick="showSheet('input')">üìù Input Data</button>
            <button class="tab" onclick="showSheet('actual')">üé≤ Actual Data</button>
            <button class="tab" onclick="showSheet('variance')">üìà Variance Analysis</button>
            <button class="tab" onclick="showSheet('scoring')">üèÜ Scoring System</button>
        </div>

        <!-- DASHBOARD -->
        <div id="dashboard" class="sheet active">
            <h2>üìä Dashboard</h2>
            
            <div class="score-card">
                <div>YOUR SCORE</div>
                <div class="score" id="dashboardScore">0</div>
                <div id="dashboardRating" style="font-size: 24px;">Generate simulation to start</div>
            </div>

            <div class="dashboard">
                <div class="card">
                    <h3>üí∞ TOTAL BUDGET</h3>
                    <div class="value" id="dashboardBudget">$140,000</div>
                </div>
                <div class="card">
                    <h3>üìä TOTAL ACTUAL</h3>
                    <div class="value" id="dashboardActual">$0</div>
                </div>
                <div class="card">
                    <h3>üìâ TOTAL VARIANCE</h3>
                    <div class="value" id="dashboardVariance">$0</div>
                </div>
            </div>

            <table>
                <thead>
                    <tr>
                        <th>Component</th>
                        <th>Budget</th>
                        <th>Actual</th>
                        <th>Variance</th>
                        <th>%</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody id="dashboardTableBody">
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 40px;">
                            Click "Generate Simulation" to start
                        </td>
                    </tr>
                </tbody>
            </table>

            <button class="button" onclick="generateSimulation()">üîÑ Generate New Simulation</button>
        </div>

        <!-- INPUT DATA -->
        <div id="input" class="sheet">
            <h2>üìù Input Data - Budget Planning</h2>
            
            <div class="instructions">
                <h3>Instructions</h3>
                <p>1. Enter Budget Units and Cost per Unit</p>
                <p>2. Click Generate Simulation to see results</p>
            </div>

            <table>
                <thead>
                    <tr>
                        <th>Component</th>
                        <th>Budget Units</th>
                        <th>Cost per Unit ($)</th>
                        <th>Total Budget ($)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Direct Materials</strong></td>
                        <td><input type="number" id="input_units_0" value="1000" onchange="updateBudget()"></td>
                        <td><input type="number" id="input_cost_0" value="50" onchange="updateBudget()"></td>
                        <td id="input_total_0" style="font-weight: bold;">$50,000.00</td>
                    </tr>
                    <tr>
                        <td><strong>Direct Labor</strong></td>
                        <td><input type="number" id="input_units_1" value="500" onchange="updateBudget()"></td>
                        <td><input type="number" id="input_cost_1" value="80" onchange="updateBudget()"></td>
                        <td id="input_total_1" style="font-weight: bold;">$40,000.00</td>
                    </tr>
                    <tr>
                        <td><strong>Variable Overhead</strong></td>
                        <td><input type="number" id="input_units_2" value="1000" onchange="updateBudget()"></td>
                        <td><input type="number" id="input_cost_2" value="20" onchange="updateBudget()"></td>
                        <td id="input_total_2" style="font-weight: bold;">$20,000.00</td>
                    </tr>
                    <tr>
                        <td><strong>Fixed Overhead</strong></td>
                        <td><input type="number" id="input_units_3" value="1" onchange="updateBudget()"></td>
                        <td><input type="number" id="input_cost_3" value="30000" onchange="updateBudget()"></td>
                        <td id="input_total_3" style="font-weight: bold;">$30,000.00</td>
                    </tr>
                    <tr class="total-row">
                        <td colspan="3" style="text-align: right;">TOTAL</td>
                        <td id="input_grand_total">$140,000.00</td>
                    </tr>
                </tbody>
            </table>

            <button class="button" onclick="generateSimulation()">üé≤ Generate Simulation</button>
        </div>

        <!-- ACTUAL DATA -->
        <div id="actual" class="sheet">
            <h2>üé≤ Actual Data</h2>
            
            <table>
                <thead>
                    <tr>
                        <th>Component</th>
                        <th>Actual Units</th>
                        <th>Cost per Unit ($)</th>
                        <th>Total Actual ($)</th>
                    </tr>
                </thead>
                <tbody id="actualTableBody">
                    <tr>
                        <td colspan="4" style="text-align: center; padding: 40px;">
                            Generate simulation first
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- VARIANCE ANALYSIS -->
        <div id="variance" class="sheet">
            <h2>üìà Variance Analysis</h2>
            
            <table>
                <thead>
                    <tr>
                        <th>Component</th>
                        <th>Budgeted</th>
                        <th>Actual</th>
                        <th>Variance ($)</th>
                        <th>Variance (%)</th>
                        <th>Type</th>
                    </tr>
                </thead>
                <tbody id="varianceTableBody">
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 40px;">
                            Generate simulation first
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- SCORING -->
        <div id="scoring" class="sheet">
            <h2>üèÜ Scoring System</h2>
            
            <div class="scoring-breakdown">
                <h4>‚úÖ Favorable Variances</h4>
                <p>+10 points per favorable variance</p>
                <span class="points" id="score_favorable">+0</span>
            </div>

            <div class="scoring-breakdown">
                <h4>‚ùå Unfavorable Variances</h4>
                <p>-5 points per unfavorable variance</p>
                <span class="points" id="score_unfavorable">-0</span>
            </div>

            <div class="scoring-breakdown">
                <h4>üéØ Accuracy Bonus</h4>
                <p>+5 points for variance within ¬±5%</p>
                <span class="points" id="score_accuracy">+0</span>
            </div>

            <div class="scoring-breakdown">
                <h4>üíé Under Budget Bonus</h4>
                <p>+15 points if total under budget</p>
                <span class="points" id="score_under">+0</span>
            </div>

            <div class="scoring-breakdown">
                <h4>‚≠ê Excellence Bonus</h4>
                <p>+20 points if total variance within ¬±5%</p>
                <span class="points" id="score_excellence">+0</span>
            </div>

            <div class="score-card">
                <div>TOTAL SCORE</div>
                <div class="score" id="totalScore">0</div>
                <div id="performanceRating" style="font-size: 24px;">Generate to calculate</div>
            </div>
        </div>
    </div>

    <script>
        const components = ['Direct Materials', 'Direct Labor', 'Variable Overhead', 'Fixed Overhead'];
        let budgetData = [];
        let actualData = [];
        let varianceData = [];
        let score = 0;

        function showSheet(sheetName) {
            document.querySelectorAll('.sheet').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.getElementById(sheetName).classList.add('active');
            event.target.classList.add('active');
        }

        function updateBudget() {
            let grandTotal = 0;
            budgetData = [];
            
            for (let i = 0; i < 4; i++) {
                const units = parseFloat(document.getElementById(`input_units_${i}`).value) || 0;
                const cost = parseFloat(document.getElementById(`input_cost_${i}`).value) || 0;
                const total = units * cost;
                
                document.getElementById(`input_total_${i}`).textContent = '$' + total.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2});
                grandTotal += total;
                
                budgetData.push({
                    component: components[i],
                    units: units,
                    cost: cost,
                    total: total
                });
            }
            
            document.getElementById('input_grand_total').textContent = '$' + grandTotal.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2});
            document.getElementById('dashboardBudget').textContent = '$' + grandTotal.toLocaleString('en-US', {minimumFractionDigits: 0});
        }

        function generateSimulation() {
            updateBudget();
            actualData = [];
            
            for (let i = 0; i < budgetData.length; i++) {
                const variance = (Math.random() * 0.3 - 0.15);
                const actualUnits = Math.round(budgetData[i].units * (1 + variance));
                const actualCost = Math.round(budgetData[i].cost * (1 + (Math.random() * 0.3 - 0.15)) * 100) / 100;
                const actualTotal = actualUnits * actualCost;
                
                actualData.push({
                    component: budgetData[i].component,
                    units: actualUnits,
                    cost: actualCost,
                    total: actualTotal
                });
            }
            
            updateActualTable();
            calculateVariances();
            calculateScore();
            updateDashboard();
            alert('‚úÖ Simulation generated successfully! Check all tabs to see results.');
        }

        function updateActualTable() {
            const tbody = document.getElementById('actualTableBody');
            let html = '';
            let grandTotal = 0;
            
            actualData.forEach(item => {
                html += `
                    <tr>
                        <td><strong>${item.component}</strong></td>
                        <td>${item.units.toLocaleString()}</td>
                        <td>$${item.cost.toFixed(2)}</td>
                        <td style="font-weight: bold;">$${item.total.toFixed(2)}</td>
                    </tr>
                `;
                grandTotal += item.total;
            });
            
            html += `
                <tr class="total-row">
                    <td colspan="3" style="text-align: right;">TOTAL</td>
                    <td>$${grandTotal.toFixed(2)}</td>
                </tr>
            `;
            
            tbody.innerHTML = html;
            document.getElementById('dashboardActual').textContent = '$' + Math.round(grandTotal).toLocaleString();
        }

        function calculateVariances() {
            varianceData = [];
            
            for (let i = 0; i < budgetData.length; i++) {
                const variance = actualData[i].total - budgetData[i].total;
                const variancePercent = (variance / budgetData[i].total) * 100;
                const type = variance <= 0 ? 'Favorable' : 'Unfavorable';
                
                varianceData.push({
                    component: budgetData[i].component,
                    budget: budgetData[i].total,
                    actual: actualData[i].total,
                    variance: variance,
                    variancePercent: variancePercent,
                    type: type
                });
            }
            
            updateVarianceTable();
        }

        function updateVarianceTable() {
            const tbody = document.getElementById('varianceTableBody');
            let html = '';
            let totalBudget = 0;
            let totalActual = 0;
            
            varianceData.forEach(item => {
                const varianceClass = item.variance <= 0 ? 'variance-negative' : 'variance-positive';
                const typeClass = item.type === 'Favorable' ? 'favorable' : 'unfavorable';
                
                html += `
                    <tr>
                        <td><strong>${item.component}</strong></td>
                        <td>$${item.budget.toFixed(2)}</td>
                        <td>$${item.actual.toFixed(2)}</td>
                        <td class="${varianceClass}">${item.variance >= 0 ? '+' : ''}$${item.variance.toFixed(2)}</td>
                        <td class="${varianceClass}">${item.variancePercent.toFixed(2)}%</td>
                        <td class="${typeClass}">${item.type === 'Favorable' ? '‚úì' : '‚úó'} ${item.type}</td>
                    </tr>
                `;
                totalBudget += item.budget;
                totalActual += item.actual;
            });
            
            const totalVariance = totalActual - totalBudget;
            const totalVariancePercent = (totalVariance / totalBudget) * 100;
            const totalClass = totalVariance <= 0 ? 'variance-negative' : 'variance-positive';
            const totalType = totalVariance <= 0 ? 'favorable' : 'unfavorable';
            
            html += `
                <tr class="total-row">
                    <td>TOTAL</td>
                    <td>$${totalBudget.toFixed(2)}</td>
                    <td>$${totalActual.toFixed(2)}</td>
                    <td>${totalVariance >= 0 ? '+' : ''}$${totalVariance.toFixed(2)}</td>
                    <td>${totalVariancePercent.toFixed(2)}%</td>
                    <td>${totalVariance <= 0 ? '‚úì Under Budget' : '‚úó Over Budget'}</td>
                </tr>
            `;
            
            tbody.innerHTML = html;
            document.getElementById('dashboardVariance').textContent = (totalVariance >= 0 ? '+' : '') + '$' + Math.round(Math.abs(totalVariance)).toLocaleString();
        }

        function calculateScore() {
            let calculatedScore = 0;
            
            const favorableCount = varianceData.filter(v => v.type === 'Favorable').length;
            const unfavorableCount = varianceData.filter(v => v.type === 'Unfavorable').length;
            const accurateCount = varianceData.filter(v => Math.abs(v.variancePercent) < 5).length;
            
            const favorablePoints = favorableCount * 10;
            const unfavorablePoints = unfavorableCount * (-5);
            const accuracyPoints = accurateCount * 5;
            
            calculatedScore += favorablePoints + unfavorablePoints + accuracyPoints;
            
            document.getElementById('score_favorable').textContent = '+' + favorablePoints;
            document.getElementById('score_unfavorable').textContent = unfavorablePoints;
            document.getElementById('score_accuracy').textContent = '+' + accuracyPoints;
            
            const totalBudget = budgetData.reduce((sum, item) => sum + item.total, 0);
            const totalActual = actualData.reduce((sum, item) => sum + item.total, 0);
            const totalVariance = totalActual - totalBudget;
            const totalVariancePercent = Math.abs((totalVariance / totalBudget) * 100);
            
            let underBudgetPoints = 0;
            let excellencePoints = 0;
            
            if (totalVariance < 0) {
                underBudgetPoints = 15;
                calculatedScore += 15;
            }
            
            if (totalVariancePercent < 5) {
                excellencePoints = 20;
                calculatedScore += 20;
            }
            
            document.getElementById('score_under').textContent = underBudgetPoints > 0 ? '+' + underBudgetPoints : '0';
            document.getElementById('score_excellence').textContent = excellencePoints > 0 ? '+' + excellencePoints : '0';
            
            score = calculatedScore;
            
            let rating = '';
            if (score >= 50) rating = 'üåü Excellent';
            else if (score >= 30) rating = 'üëç Good';
            else if (score >= 10) rating = 'üìä Fair';
            else rating = 'üìà Needs Improvement';
            
            document.getElementById('totalScore').textContent = score;
            document.getElementById('performanceRating').textContent = rating;
            document.getElementById('dashboardScore').textContent = score;
            document.getElementById('dashboardRating').textContent = rating;
        }

        function updateDashboard() {
            const tbody = document.getElementById('dashboardTableBody');
            let html = '';
            
            varianceData.forEach(item => {
                const varianceClass = item.variance <= 0 ? 'variance-negative' : 'variance-positive';
                const typeClass = item.type === 'Favorable' ? 'favorable' : 'unfavorable';
                
                html += `
                    <tr>
                        <td><strong>${item.component}</strong></td>
                        <td>$${Math.round(item.budget).toLocaleString()}</td>
                        <td>$${Math.round(item.actual).toLocaleString()}</td>
                        <td class="${varianceClass}">${item.variance >= 0 ? '+' : ''}$${Math.round(item.variance).toLocaleString()}</td>
                        <td class="${varianceClass}">${item.variancePercent.toFixed(2)}%</td>
                        <td class="${typeClass}">${item.type}</td>
                    </tr>
                `;
            });
            
            tbody.innerHTML = html;
        }

        function exportToCSV() {
            let csv = 'CostMaster Pro - Training Simulator - Export\n\n';
            
            csv += 'INPUT DATA\n';
            csv += 'Component,Budget Units,Cost per Unit,Total Budget\n';
            budgetData.forEach(item => {
                csv += `${item.component},${item.units},${item.cost},${item.total}\n`;
            });
            
            csv += '\nACTUAL DATA\n';
            csv += 'Component,Actual Units,Cost per Unit,Total Actual\n';
            actualData.forEach(item => {
                csv += `${item.component},${item.units},${item.cost},${item.total}\n`;
            });
            
            csv += '\nVARIANCE ANALYSIS\n';
            csv += 'Component,Budgeted Cost,Actual Cost,Variance,Variance %,Type\n';
            varianceData.forEach(item => {
                csv += `${item.component},${item.budget},${item.actual},${item.variance},${item.variancePercent},${item.type}\n`;
            });
            
            csv += '\nSCORING\n';
            csv += 'Total Score,' + score + '\n';
            csv += 'Performance,' + document.getElementById('performanceRating').textContent + '\n';
            
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', 'CostMaster_Pro_Data.csv');
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function downloadThisPage() {
            const htmlContent = document.documentElement.outerHTML;
            const blob = new Blob([htmlContent], { type: 'text/html' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'CostMaster_Pro_Simulator.html';
            link.click();
        }

        // Initialize
        updateBudget();
    </script>
</body>
</html>